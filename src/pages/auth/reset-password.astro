---
import Layout from "../../layouts/Layout.astro";
import { AuthForm } from "../../components/auth/AuthForm";
import { AuthLayout } from "../../components/auth/AuthLayout";

// Sprawdzenie czy użytkownik już jest zalogowany
const { user } = Astro.locals;
if (user) {
  return Astro.redirect("/dashboard");
}

// Pobranie tokenu z URL - Supabase wysyła token w różnych formatach
const token =
  Astro.url.searchParams.get("access_token") ||
  Astro.url.searchParams.get("token") ||
  Astro.url.hash.split("access_token=")[1]?.split("&")[0];

if (!token) {
  return Astro.redirect("/auth/forgot-password?error=missing-token");
}

const title = "Resetuj hasło - 10xCards";
---

<Layout title={title}>
  <AuthLayout title="Ustaw nowe hasło" subtitle="Wprowadź nowe hasło dla swojego konta" client:load>
    <AuthForm mode="reset-password" resetToken={token} client:load />
  </AuthLayout>
</Layout>
